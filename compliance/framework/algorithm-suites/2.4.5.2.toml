target = "compliance/framework/algorithm-suites.txt#2.4.5.2"

# 2.4.5.2.  HKDF Commit Key
#
# If an algorithm suite uses HKDF to derive the commitment key the AWS
# Encryption SDK MUST use HKDF with the following specifics:
# 
# *  The hash function MUST be specified by the algorithm suite
#    commitment settings (Section 2.8).
# 
# *  For the extract step:
# 
#    -  The input keying material MUST be the data key generated by the
#       key provider.
# 
#    -  The length of the input keying material MUST equal the key
#       derivation input length (Section 2.10.8) specified by the
#       algorithm suite commit key derivation setting.
# 
#    -  The salt MUST be the message ID (../data-format/message-
#       header.md#message-id) with a length of 256 bits.
# 
# *  For the expand step:
# 
#    -  The input pseudorandom key MUST be the output from the extract
#       step.
# 
#    -  The length of the output keying material MUST equal the
#       algorithm suite data length (Section 2.10.16) specified by the
#       supported algorithm suites (Section 2.5).
# 
#    -  The input info MUST the string "COMMITKEY" as UTF8 encoded
#       bytes by the algorithm suite commitment settings.
# 
# For algorithm suites that support commitment, the AWS Encryption SDK
# SHOULD only perform the extract step once and use the same output
# from the extract step for both the encryption key and the commitment
# key.
# 
# Verification of the commitment key MUST be a constant time
# comparison.

[[spec]]
level = "MUST"
quote = '''
If an algorithm suite uses HKDF to derive the commitment key the AWS
Encryption SDK MUST use HKDF with the following specifics:
'''

[[spec]]
level = "MUST"
quote = '''
*  The hash function MUST be specified by the algorithm suite
commitment settings (Section 2.8).
'''

[[spec]]
level = "MUST"
quote = '''
-  The input keying material MUST be the data key generated by the
key provider.
'''

[[spec]]
level = "MUST"
quote = '''
-  The length of the input keying material MUST equal the key
derivation input length (Section 2.10.8) specified by the
algorithm suite commit key derivation setting.
'''

[[spec]]
level = "MUST"
quote = '''
-  The salt MUST be the message ID (../data-format/message-
header.md#message-id) with a length of 256 bits.
'''

[[spec]]
level = "MUST"
quote = '''
-  The input pseudorandom key MUST be the output from the extract
step.
'''

[[spec]]
level = "MUST"
quote = '''
-  The length of the output keying material MUST equal the
algorithm suite data length (Section 2.10.16) specified by the
supported algorithm suites (Section 2.5).
'''

[[spec]]
level = "MUST"
quote = '''
-  The input info MUST the string "COMMITKEY" as UTF8 encoded
bytes by the algorithm suite commitment settings.
'''

[[spec]]
level = "SHOULD"
quote = '''
For algorithm suites that support commitment, the AWS Encryption SDK
SHOULD only perform the extract step once and use the same output
from the extract step for both the encryption key and the commitment
key.
'''

[[spec]]
level = "MUST"
quote = '''
Verification of the commitment key MUST be a constant time
comparison.
'''

